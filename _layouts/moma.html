<!DOCTYPE html>
{% assign lang = page.lang | default: site.lang | default: "ru" %}
{% assign t = site.data.translations[lang] %}
<html lang="{{ lang }}" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% if page.title %}{{ page.title }} — {% endif %}{{ t.site.title | default: site.title }}</title>
  <meta name="description" content="{{ page.excerpt | strip_html | strip_newlines | default: t.site.description | default: site.description }}" />

  <!-- MoMA-inspired fonts: Inter for body, bold display font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{{ '/assets/css/moma-style.css' | relative_url }}" />
  <link rel="icon" type="image/png" href="{{ '/assets/images/favicon.png' | relative_url }}" />
  {% seo %}
</head>
<body>
  <!-- Sticky Minimal Sidebar Navigation -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-inner">
      <div class="sidebar-brand">
        <a href="{% if lang == 'ru' %}{{ '/' | relative_url }}{% else %}{{ '/' | append: lang | append: '/' | relative_url }}{% endif %}" class="logo">СК</a>
      </div>

      <!-- Language Switcher -->
      <div class="lang-switcher">
        {% for language in site.languages %}
          {% if language == lang %}
            <span class="lang-link active">{{ site.language_names[language] }}</span>
          {% else %}
            {% if language == 'ru' %}
              {% comment %} For Russian, strip any language prefix and go to root {% endcomment %}
              {% assign ru_url = page.url | remove: '/en' | remove: '/ky' %}
              {% if ru_url == '/' or ru_url == '/index.html' %}
                <a href="{{ '/' | relative_url }}" class="lang-link">{{ site.language_names[language] }}</a>
              {% else %}
                <a href="{{ ru_url | relative_url }}" class="lang-link">{{ site.language_names[language] }}</a>
              {% endif %}
            {% else %}
              {% comment %} For other languages, add language prefix {% endcomment %}
              {% assign base_url = page.url | remove: '/en' | remove: '/ky' %}
              {% if base_url == '/' or base_url == '/index.html' %}
                <a href="{{ '/' | append: language | append: '/' | relative_url }}" class="lang-link">{{ site.language_names[language] }}</a>
              {% else %}
                <a href="{{ '/' | append: language | append: base_url | relative_url }}" class="lang-link">{{ site.language_names[language] }}</a>
              {% endif %}
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>

      <nav class="sidebar-nav" aria-label="{{ t.nav.home }}">
        <ul>
          <li>
            <a href="{% if lang == 'ru' %}{{ '/' | relative_url }}{% else %}{{ '/' | append: lang | append: '/' | relative_url }}{% endif %}"
               {% if page.url == '/' or page.url == '/index.html' %}aria-current="page" class="active"{% endif %}>
              {{ t.nav.home }}
            </a>
          </li>
          <li><a href="{% if lang == 'ru' %}/pages/istoriya.html{% else %}/{{ lang }}/pages/istoriya.html{% endif %}">{{ t.nav.history }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/proiskhozhdenie.html{% else %}/{{ lang }}/pages/proiskhozhdenie.html{% endif %}">{{ t.nav.origin }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/byt-i-kultura.html{% else %}/{{ lang }}/pages/byt-i-kultura.html{% endif %}">{{ t.nav.culture }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/hozyaystvo.html{% else %}/{{ lang }}/pages/hozyaystvo.html{% endif %}">{{ t.nav.economy }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/yazyk.html{% else %}/{{ lang }}/pages/yazyk.html{% endif %}">{{ t.nav.language }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/religiya.html{% else %}/{{ lang }}/pages/religiya.html{% endif %}">{{ t.nav.religion }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/fotoarhiv.html{% else %}/{{ lang }}/pages/fotoarhiv.html{% endif %}">{{ t.nav.photos }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/karty.html{% else %}/{{ lang }}/pages/karty.html{% endif %}">{{ t.nav.maps }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/ustnye-predaniya.html{% else %}/{{ lang }}/pages/ustnye-predaniya.html{% endif %}">{{ t.nav.oral_traditions }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/bibliografiya.html{% else %}/{{ lang }}/pages/bibliografiya.html{% endif %}">{{ t.nav.bibliography }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/blog.html{% else %}/{{ lang }}/pages/blog.html{% endif %}">{{ t.nav.blog }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/o-proekte.html{% else %}/{{ lang }}/pages/o-proekte.html{% endif %}">{{ t.nav.about }}</a></li>
          <li><a href="{% if lang == 'ru' %}/pages/kontakty.html{% else %}/{{ lang }}/pages/kontakty.html{% endif %}">{{ t.nav.contacts }}</a></li>
        </ul>
      </nav>

      <div class="sidebar-footer">
        <a href="/admin/" class="admin-link" title="Admin Panel">⚙</a>
        <button class="theme-toggle" id="themeToggle" aria-label="{{ t.ui.toggle_theme }}">
          <span class="icon-sun">☀</span>
          <span class="icon-moon">☾</span>
        </button>
      </div>
    </div>
  </aside>

  <!-- Mobile Top Bar -->
  <header class="mobile-header">
    <a href="{% if lang == 'ru' %}{{ '/' | relative_url }}{% else %}{{ '/' | append: lang | append: '/' | relative_url }}{% endif %}" class="mobile-logo">{{ t.hero.title_1 }}{{ t.hero.title_2 }}</a>
    <div class="mobile-lang-switcher">
      {% for language in site.languages %}
        {% if language == lang %}
          <span class="lang-link active">{{ language | upcase }}</span>
        {% else %}
          {% if language == 'ru' %}
            {% assign ru_url = page.url | remove: '/en' | remove: '/ky' %}
            {% if ru_url == '/' or ru_url == '/index.html' %}
              <a href="{{ '/' | relative_url }}" class="lang-link">{{ language | upcase }}</a>
            {% else %}
              <a href="{{ ru_url | relative_url }}" class="lang-link">{{ language | upcase }}</a>
            {% endif %}
          {% else %}
            {% assign base_url = page.url | remove: '/en' | remove: '/ky' %}
            {% if base_url == '/' or base_url == '/index.html' %}
              <a href="{{ '/' | append: language | append: '/' | relative_url }}" class="lang-link">{{ language | upcase }}</a>
            {% else %}
              <a href="{{ '/' | append: language | append: base_url | relative_url }}" class="lang-link">{{ language | upcase }}</a>
            {% endif %}
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
    <button class="hamburger" id="menuToggle" aria-label="{{ t.ui.open_menu }}">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobileMenuOverlay">
    <nav class="mobile-nav">
      <ul>
        <li><a href="{% if lang == 'ru' %}{{ '/' | relative_url }}{% else %}{{ '/' | append: lang | append: '/' | relative_url }}{% endif %}">{{ t.nav.home }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/istoriya.html{% else %}/{{ lang }}/pages/istoriya.html{% endif %}">{{ t.nav.history }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/proiskhozhdenie.html{% else %}/{{ lang }}/pages/proiskhozhdenie.html{% endif %}">{{ t.nav.origin }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/byt-i-kultura.html{% else %}/{{ lang }}/pages/byt-i-kultura.html{% endif %}">{{ t.nav.culture }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/hozyaystvo.html{% else %}/{{ lang }}/pages/hozyaystvo.html{% endif %}">{{ t.nav.economy }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/yazyk.html{% else %}/{{ lang }}/pages/yazyk.html{% endif %}">{{ t.nav.language }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/religiya.html{% else %}/{{ lang }}/pages/religiya.html{% endif %}">{{ t.nav.religion }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/fotoarhiv.html{% else %}/{{ lang }}/pages/fotoarhiv.html{% endif %}">{{ t.nav.photos }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/karty.html{% else %}/{{ lang }}/pages/karty.html{% endif %}">{{ t.nav.maps }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/ustnye-predaniya.html{% else %}/{{ lang }}/pages/ustnye-predaniya.html{% endif %}">{{ t.nav.oral_traditions }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/bibliografiya.html{% else %}/{{ lang }}/pages/bibliografiya.html{% endif %}">{{ t.nav.bibliography }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/blog.html{% else %}/{{ lang }}/pages/blog.html{% endif %}">{{ t.nav.blog }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/o-proekte.html{% else %}/{{ lang }}/pages/o-proekte.html{% endif %}">{{ t.nav.about }}</a></li>
        <li><a href="{% if lang == 'ru' %}/pages/kontakty.html{% else %}/{{ lang }}/pages/kontakty.html{% endif %}">{{ t.nav.contacts }}</a></li>
      </ul>
      <div class="mobile-theme-toggle">
        <button class="theme-toggle" id="mobileThemeToggle" aria-label="{{ t.ui.toggle_theme }}">
          <span class="icon-sun">☀</span>
          <span class="icon-moon">☾</span>
        </button>
      </div>
    </nav>
  </div>

  <!-- Main Content Area -->
  <main class="main-content" role="main">
    {{ content }}
  </main>

  <!-- Minimal Footer -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-grid">
        <div class="footer-col">
          <p class="footer-brand">{{ t.footer.brand }}</p>
          <p class="footer-tagline">{{ t.footer.tagline }}</p>
        </div>
        <div class="footer-col">
          <p class="footer-copyright">{{ t.footer.copyright }} {{ site.time | date: '%Y' }}</p>
          <p class="footer-meta">
            <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a>
          </p>
        </div>
      </div>
    </div>
  </footer>

  <script src="{{ '/assets/js/moma-main.js' | relative_url }}" defer></script>

  <!-- Netlify Identity Widget for CMS authentication -->
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</body>
</html>

